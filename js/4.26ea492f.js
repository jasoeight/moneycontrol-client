(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"+g00":function(e,t,a){"use strict";a.d(t,"a",function(){return o});var s=a("yT7P"),n=a("L2JU"),o=(Object(s["a"])({},Object(n["d"])("users",{})),Object(n["b"])("users",["saveUser","fetchAllUsers","deleteUser"]))},"7YFy":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("layout-main",{attrs:{row:"",wrap:""}},[a("v-flex",{staticClass:"my-3",attrs:{xs12:""}},[a("user-table",{ref:"table",on:{edit:e.onEdit,add:e.onAdd}})],1),e.showForm?a("v-flex",{attrs:{xs12:""}},[a("user-form",{ref:"form",on:{cancel:e.onCancel,stored:e.onStored},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1):e._e()],1)},n=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",[a("v-card-title",[a("v-spacer"),a("v-btn",{attrs:{small:"",color:"primary"},on:{click:function(t){e.$emit("add")}}},[a("v-icon",[e._v("add")]),e._v(" Add\n        ")],1)],1),a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,pagination:e.pagination,"total-items":e.totalItems,loading:e.loading},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.name))]),a("td",[e._v(e._s(t.item.email))]),a("td",[e._v(e._s(t.item.all))]),a("td",{staticClass:"justify-center layout px-0"},[a("v-btn",{staticClass:"mx-0",attrs:{icon:""},on:{click:function(a){e.onEdit(t.item)}}},[a("v-icon",{attrs:{color:"teal"}},[e._v("edit")])],1),a("v-btn",{staticClass:"mx-0",attrs:{icon:""},on:{click:function(a){e.onDelete(t.item)}}},[a("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1)],1)]}}])},[a("template",{slot:"no-data"},[a("v-alert",{attrs:{value:!e.loading,color:"error",icon:"warning"}},[e._v("\n                Sorry, nothing to display here\n            ")])],1)],2)],1)},i=[],r=a("yT7P"),l=a("+g00"),c=a("lfAH"),u={data:function(){return{totalItems:0,items:[],loading:!0,pagination:{sortBy:"email",descending:!0,page:1,rowsPerPage:10},headers:[{text:"Name",sortable:!0,value:"name"},{text:"Email",sortable:!0,value:"email"},{text:"All",sortable:!0,value:"all"},{text:"Actions",sortable:!1,value:"_id"}]}},watch:{pagination:{handler:"load",deep:!0}},methods:Object(r["a"])({},l["a"],c["a"],{load:function(){var e=this;this.loading=!0;var t=this.pagination,a=t.sortBy,s=t.descending,n=t.page,o=t.rowsPerPage;this.fetchAllUsers({sortBy:a,sortDir:s?"desc":"asc",page:n,limit:o}).then(function(t){var a=t.data;e.loadFinished(a.rows,a.count)}).catch(function(){e.loadFinished([],0)})},loadFinished:function(e,t){this.items=e,this.totalItems=t,this.loading=!1},onEdit:function(e){this.$emit("edit",e)},onDelete:function(e){var t=this,a=e._id;this.hasNoTransactions(a).then(function(){t.deleteUser(a).then(t.load)}).catch(function(){t.$dialog.alert("Cannot remove user because of existing references in some transactions.",{okText:"Ok"})})},hasNoTransactions:function(e){var t=this;return new Promise(function(a,s){t.fetchAllTransactions({user:e,limit:1,noPopulate:1}).then(function(e){var t=e.data;0!==t.count?s():a()}).catch(function(e){s()})})}})},d=u,m=a("KHd+"),v=Object(m["a"])(d,o,i,!1,null,null,null),f=v.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",[a("v-card-text",[a("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-text-field",{attrs:{label:"name",rules:e.rules.name},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}}),a("v-text-field",{attrs:{rules:e.rules.email,label:"Email"},model:{value:e.value.email,callback:function(t){e.$set(e.value,"email",t)},expression:"value.email"}}),a("v-text-field",{attrs:{"append-icon":e.showPassword?"visibility_off":"visibility",rules:e.rules.password,type:e.showPassword?"text":"password",label:"Password",counter:""},on:{"click:append":function(t){e.showPassword=!e.showPassword}},model:{value:e.value.password,callback:function(t){e.$set(e.value,"password",t)},expression:"value.password"}}),a("v-checkbox",{attrs:{color:"green"},model:{value:e.value.all,callback:function(t){e.$set(e.value,"all",t)},expression:"value.all"}},[a("div",{attrs:{slot:"label"},slot:"label"},[e._v("All")])]),a("v-btn",{on:{click:e.onCancel}},[e._v("Cancel")]),a("v-btn",{attrs:{color:"success"},on:{click:e.onSubmit}},[e._v("Submit")])],1)],1)],1)},p=[],w=a("5EAj"),b=a.n(w),g=a("E+oP"),x=a.n(g),_={props:{value:{type:Object,required:!0}},data:function(){return{valid:!0,showPassword:!1,rules:{name:[function(e){return!!e||"Name is required"},function(e){return e&&e.length>=5||"Min 5 characters"}],email:[function(e){return!!e||"Email is required"},function(e){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)||"Invalid email."}],password:this.getPasswordRules()}}},methods:Object(r["a"])({},l["a"],{getPasswordRules:function(){var e=[];return x()(this.value)?(e.push(function(e){return!!e||"Password is required"}),e.push(function(e){return e&&e.length>=8||"Min 8 characters"})):e.push(function(e){var t=e.length;return 0===t||t>=8||"Min 8 characters"}),e},onCancel:function(){this.$emit("cancel")},onSubmit:function(){var e=this;this.$refs.form.validate()&&this.saveUser(this.value).then(function(){e.$emit("stored"),e.showSuccessMsg()}).catch(this.showErrorMsg)},prepare:function(){this.loading=!0,this.prepareNew()},prepareNew:function(){x()(this.value)&&this.$emit("input",{name:"",email:"",password:"",all:!1})}}),watch:{value:"prepareNew"},created:function(){this.prepare()},notifications:{showSuccessMsg:{type:b.a.types.success,title:"",message:"User successfully saved."},showErrorMsg:{type:b.a.types.error,title:"",message:"Could not save user."}}},y=_,k=Object(m["a"])(y,h,p,!1,null,null,null),P=k.exports,$=a("BkRI"),E=a.n($),A={components:{UserTable:f,UserForm:P},data:function(){return{showForm:!1,form:{}}},methods:{onAdd:function(){this.form={},this.showForm=!0},onCancel:function(){this.showForm=!1,this.form={}},onEdit:function(e){e=E()(e),e.password="",this.form=e,this.showForm=!0},onStored:function(){this.showForm=!1,this.form={},this.$refs.table.load()}}},C=A,j=Object(m["a"])(C,s,n,!1,null,null,null);t["default"]=j.exports}}]);
//# sourceMappingURL=4.26ea492f.js.map